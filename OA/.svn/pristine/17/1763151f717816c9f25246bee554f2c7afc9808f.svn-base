<%@ page language="java" contentType="text/html; charset=UTF-8"    pageEncoding="utf-8"%>
<%@ taglib uri="/WEB-INF/master/masterPage.tld" prefix="tempus" %>
<%@ taglib uri="http://www.springframework.org/tags" prefix="i18n" %>
<%@ page import="org.springframework.web.servlet.support.RequestContextUtils" language="java"%>
<%@ page import="java.util.UUID" language="java"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
<%
	String locale = RequestContextUtils.getLocaleResolver(request).resolveLocale(request).toString();
	String url = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+request.getContextPath();
	String basepath = request.getServerName() + ":" + request.getServerPort() + request.getContextPath();
	String scheme = request.getScheme();
%>
    <link href="../assets/global/plugins/datatables/datatables.min.css" rel="stylesheet" type="text/css" />
    <link href="../assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="../assets/global/plugins/jquery-file-upload/css/jquery.fileupload.css" rel="stylesheet" type="text/css" />
    <link href="../assets/global/plugins/jquery-file-upload/css/jquery.fileupload-ui.css" rel="stylesheet" type="text/css" />
    	<div class="form-horizontal" >
    		<button class='btn btn-success pull-right' style="margin-top: -65px;" onclick="printform('${returnObject.FID}')">打印</button>
    		<input type="hidden" id="status" name="status" />
    		<input type="hidden" id="id" name="id" value="${returnObject.FID}"/>
    		<div class="row">
    			<div class="col-md-10 col-md-offset-1">
    				<div class="form-group" style="padding: 0px 15px;">
		           		<label class="col-md-2 control-label">标题<span class="readonly">*</span></label>
		           		<div class="col-md-10"><input class="form-control" name="name" value="${returnObject.FNAME}" readonly /></div>
		   			</div>
    				<div class="col-md-6">
		   				<div class="form-group">
			           		<label class="col-md-4 control-label">申请人</label>
			           		<div class="col-md-8"><input class="form-control" value="${returnObject.FCREATORNAME}" readonly /></div>
			   			</div>
			   			<div class="form-group">
			           		<label class="col-md-4 control-label">金额<span class="readonly">*</span></label>
			           		<div class="col-md-8"><input class="form-control" id="amount" name="amount" value="${returnObject.FAMOUNT}" readonly /></div>
			   			</div>	
	    			</div>
	    			<div class="col-md-6">
			   			<div class="form-group">
			           		<label class="col-md-4 control-label">部门</label>
			           		<div class="col-md-8"><input class="form-control" value="${returnObject.FDEPARTMENTNAME}" readonly /></div>
			   			</div>
 			   			<div class="form-group">
			                <label class="col-md-4 control-label">币种<span class="readonly">*</span></label>
			                <div class="col-md-8">
				                <select class="form-control" name="currency" disabled >
				                	<option value="">请选择</option>
				                	<option value="CNY" <c:if test="${returnObject.FCURRENCY=='CNY'}" >selected</c:if> >人民币 CNY</option>
				                	<option value="HKD" <c:if test="${returnObject.FCURRENCY=='HKD'}" >selected</c:if> >港币 HKD</option>
				                	<option value="USD" <c:if test="${returnObject.FCURRENCY=='USD'}" >selected</c:if> >美元币 USD</option>
				                </select>
			                </div>
		                </div>
	    			</div>
	    			<div class="form-group" style="padding: 0px 15px;">
		           		<label class="col-md-2 control-label">客户名称<span class="readonly">*</span></label>
		           		<div class="col-md-10"><input class="form-control" name="client" value="${returnObject.FCLIENT}" readonly /></div>
		   			</div>
		   			<div class="form-group" style="padding: 0px 15px;">
		           		<label class="col-md-2 control-label">招待地点<span class="readonly">*</span></label>
		           		<div class="col-md-10"><input class="form-control" name="location" value="${returnObject.FLOCATION}" readonly /></div>
		   			</div>   			
		   			<div class="form-group" style="padding: 0px 15px;">
		           		<label class="col-md-2 control-label">事由<span class="readonly">*</span></label>
		           		<div class="col-md-10"><textarea class="form-control" name="cause" readonly >${returnObject.FCAUSE}</textarea></div>
		   			</div>
		   			<div class="col-md-6">
			   			<div class="form-group">
			           		<label class="col-md-4 control-label">申请日期<span class="readonly">*</span></label>
			           		<div class="col-md-8">
			           			<div class="input-group date date-picker" data-date-format="yyyy-mm-dd" >
				                    <input name="date" class="form-control" value="${fn:substring(returnObject.FDATE, 0, 10)}" readonly />
				                    <span class="input-group-btn" style="vertical-align: top;">
				                        <button class="btn default" type="button">
				                            <i class="fa fa-calendar"></i>
				                        </button>
				                    </span>
				                </div>
			           		</div>
			   			</div>
		   			</div>
		   			<div class="col-md-6">
		   				<div class="form-group">
			           		<label class="col-md-4 control-label">参加人数<span class="readonly">*</span></label>
			           		<div class="col-md-8"><input class="form-control" name="peoplenumber" value="${returnObject.FPEOPLENUMBER}" readonly onkeyup="clearNoNum(this)" /></div>
			   			</div>
		   			</div>
		   			<div class="form-group" style="padding: 0px 15px;">
		           		<label class="col-md-2 control-label">公司陪同人员<span class="readonly">*</span></label>
		           		<div class="col-md-10"><input class="form-control" name="staff" value="${returnObject.FSTAFF}" readonly /></div>
		   			</div>
    			
    			</div>
    		</div>
    	</div>
    	<hr/>
    	<div style="float: left;height: 34px;line-height: 34px;">附件：</div>
	    <div class="progress" style="margin-top: 16px;display: none;">
			<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="60"aria-valuemin="0" aria-valuemax="100" style="text-align: left;">
				<span style="color: black;margin-left: 16px;">40% 完成</span>
			</div>
		</div>
   		<table id="filelist" class="table table-striped table-bordered table-hover table-checkable order-column" style="margin-top: 16px;">
	        <thead>
	            <tr>
	            	<th>序号</th>
	            	<th>文件名称</th>
	            	<th>文件大小</th>
	            	<th>上传人</th><th>上传时间</th>
	                <th>操作</th>
	            </tr>
	        </thead>
	        <tbody></tbody>
		</table>
		
		<div id="modal_qrcode" class="modal fade bs-modal-lg" tabindex="-1">
			<div class="modal-dialog" style="width: 300px;height: 300px;">
				<div id="qrcode"></div>
			</div>
		</div>
<script src="../assets/global/scripts/datatable.js" type="text/javascript"></script>
<script src="../assets/global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
<script src="../assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
<script>
$(function(){
    initfilelist();
});

var initfilelist = function(){
	$("#filelist").DataTable({
		serverSide: true,
		ordering: true,
		searching: false,
		order: [[1, "asc"]],
		lengthMenu: [[10,20,50,100],[10,20,50,100]],
      	pageLength: 10,
      	pagingType: "bootstrap_full_number",
		dom: '<<t>lp>',
		ajax: {
	        url: '../file/getFileList',
	        data: function(data){
	        	data.bid=$("#id").val();
	        }
		},
	    columns: [
	    	{data:"RN",orderable: false},
	    	{data:"FNAME"},
	    	{data:"FSIZE",render:function(data, type, row){
	    		if(row.FSIZE < 1024){
	    			return row.FSIZE+"B";
	    		}else if(row.FSIZE > 1024 && row.FSIZE < 1024*1024){
	    			return (row.FSIZE/1024).toFixed(2)+"KB";
	    		}else if(row.FSIZE > 1024*1024 && row.FSIZE < 1024*1024*1024){
	    			return (row.FSIZE / (1024 * 1024)).toFixed(2)+"MB";
	    		}
	    	}},
	    	{data:"FCREATORNAME"},{data:"FCREATETIME"},
	    	{orderable: false,render:function(data, type, row){
	    		return '<div class="btn-group">'
			    		+'<button class="btn btn-xs green dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">'
			    			+'<i class="fa fa-angle-down"></i> Actions'
		    			+'</button>'
		    			+'<ul class="dropdown-menu" role="menu">'
		    				+((row.FTYPE.toUpperCase()=="JPG" || row.FTYPE.toUpperCase()=="PNG" || row.FTYPE.toUpperCase()=="GIF")?'<li><a href="javascript: viewimage('+row.SEQ+')" ><span class="icon-docs"></span>查看图片</a></li>':'')
							+'<li><a href="../file/download?id='+row.FID+'"><span class="icon-docs"></span>下载</a></li>'
						+'</ul>'
					+' </div>';
	    	}}
	    ],
        language: {
        	processin: "<i18n:message code="datatable.processin" />",
        	loadingRecords: "<i18n:message code="datatable.loadingRecords" />",
            zeroRecord: "<i18n:message code="datatable.zeroRecord" />",
            emptyTable: "<i18n:message code="datatable.emptyTable" />",
            info: "<i18n:message code="datatable.info" />",
            infoFiltered: "<i18n:message code="datatable.infoFiltered" />",
           	lengthMenu: "<i18n:message code="datatable.lengthMenu" />",
           	search: "<i18n:message code="datatable.search" />",
            paginate:{
            	first: "<i18n:message code="datatable.first" />",
            	last: "<i18n:message code="datatable.last" />",
            	next: "<i18n:message code="datatable.next" />",
            	previous: "<i18n:message code="datatable.previous" />"
            }
        }
	});
}

var printform = function(id){
    $.get("../Print/BusinessHospitality",{"id":id},function(jsp){
    	var newwindow = window.open();
    	if(newwindow){
    		newwindow.document.write(jsp);
	    	newwindow.print();
	    	newwindow.document.getElementById("print").execWB(7,1);
    	}else{
    		alert("请允许弹出式窗口，地址栏右侧更改设置");
    	}
    });
}
</script>